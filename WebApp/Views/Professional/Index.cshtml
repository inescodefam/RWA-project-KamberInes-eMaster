@model WebApp.Models.ProfessionalIndexVM

@{
    ViewData["Title"] = "Professional List";

}
@if (Model?.Professionals?.Count == 0)
{
    <div>No professionals found.</div>
}
<h2>Professionals List</h2>

<div class="container py-4">
    <div class="card shadow-lg mb-5">
        <div class="card-header bg-primary text-white py-3">
            <h3 class="mb-0"><i class="bi bi-search me-2"></i>Search Professionals</h3>
        </div>
        <div class="card-body">
            <form id="searchProfessionalForm" class="row g-3" method="get">
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="text" id="searchUsername" name="username" class="form-control" placeholder="Enter username" />
                        <label asp-for="Users" for="searchUsername"><i class="bi bi-person-fill me-2"></i>Username</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <select id="searchCityName" name="cityName" class="form-select">
                            <option value="">All cities</option>
                            @foreach (var city in Model.Cities)
                            {
                                <option value="@city.Text">@city.Text</option>
                            }
                        </select>
                        <label asp-for="Cities" for="searchCityName"><i class="bi bi-geo-alt-fill me-2"></i>City</label>
                    </div>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary w-100 py-2">
                        <i class="bi bi-search me-2"></i>Search Professionals
                    </button>
                 
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-lg">
        <div class="card-header bg-light py-3">
            <h4 class="mb-0"><i class="bi bi-list-task me-2"></i>Search Results</h4>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table id="searchProfessionalsTable" class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th><i class="bi bi-person-badge me-2"></i>Professional</th>
                            <th><i class="bi bi-geo-alt me-2"></i>City</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div id="noResultsMessage" class="text-center py-5 d-none">
                <i class="bi bi-people display-4 text-muted mb-3"></i>
                <p class="h4 text-muted">No professionals found</p>
                <p class="text-muted">Try different search criteria</p>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>

        $(document).ready(function() {

            $('#noResultsMessage').removeClass('d-none');

            $('#searchProfessionalForm').submit(function(e) {

                e.preventDefault();

                var username = $('#searchUsername').val();
                var cityName = $('#searchCityName').val();

                $.ajax({
                    url: '@Url.Action("Search", "Professional")',
                    type: 'GET',
                    data: {
                        username: username,
                        city: cityName,
                        count: 100,
                        start: 0
                    },
                    success: function(results) {
                        console.log(results);
                        var professionals = results.professionals;
                        var $tbody = $('#searchProfessionalsTable tbody');
                        $tbody.empty();

                        if (professionals && professionals.length > 0) {
                            $('#noResultsMessage').addClass('d-none');
                            $.each(professionals, function(i, p) {
                                $tbody.append(
                                    `<tr>
                                        <td>${p.userName || '-'}</td>
                                        <td>${p.cityNames.join(", ") || '-'}</td>
                                    </tr>`
                                );
                            });
                        } else {
                            $('#noResultsMessage').removeClass('d-none');
                        }
                    },
                    error: function(xhr) {
                        console.error('Search error:', xhr.responseText);
                        alert('Error searching professionals. Please try again.');
                    }
                }); 
            }); 
        }); 
    </script>
}


